<!DOCTYPE html>
<html lang="ar" dir="rtl" id="htmlRoot">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GQ3T6MFMZM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'G-GQ3T6MFMZM', {
        send_page_view: true
      });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اصنع شهادة تقدير لطفلك الصائم</title>
    
    <!-- Facebook browser detection and handling -->
    <script>
      function isFacebookBrowser() {
        var ua = navigator.userAgent || navigator.vendor || window.opera;
        return (ua.indexOf("FBAN") > -1) || (ua.indexOf("FBAV") > -1) || (ua.indexOf("Instagram") > -1);
      }

      // If coming from a Facebook browser without the external parameter, add a visible button at the top of the page
      if (isFacebookBrowser() && !window.location.href.includes('external=true')) {
        // Don't do anything automatic - just prepare for adding notice
        window.isFacebookBrowser = true;
      }
      
      // Check if this is an external=true request (which means we're trying to break out of Facebook)
      if (window.location.href.includes('external=true')) {
        // This is our breakout attempt - additional handling is done in the body
        window.isExternalAttempt = true;
      }
    </script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <img src="logo.png" alt="Logo">
            </div>
            <div class="language-toggle">
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero section removed as requested -->
        
        <section id="generator" class="generator-section">
            <div class="container">
                <div class="form-container">
                    <div class="title-decoration">
                        <h2>كافئ أطفالك على صيامهم وجهودهم في رمضان، وامنحهم شهادة تقديراً لصيامهم الشهر الكريم</h2>
                    </div>
                    <form id="certificateForm">
                        <div class="form-group">
                            <label for="fullName">اسم طفلك</label>
                            <input type="text" id="fullName" name="fullName" 
                                   placeholder="أدخل اسم طفلك" 
                                   dir="rtl" 
                                   maxlength="13"
                                   required>
                        </div>

                        <div class="form-group">
                            <label for="signature">التوقيع</label>
                            <input type="text" id="signature" name="signature" 
                                   placeholder="أدخل توقيعك" 
                                   dir="rtl" 
                                   maxlength="13"
                                   required>
                        </div>

                        <div class="form-group gender-section">
                            <div class="gender-inputs">
                                <label>الجنس</label>
                                <div class="radio-group">
                                    <input type="radio" id="male" name="gender" value="male" required>
                                    <label for="male">ذكر</label>
                                    <input type="radio" id="female" name="gender" value="female">
                                    <label for="female">أنثى</label>
                                </div>
                            </div>
                            <div class="template-preview">
                                <img src="cert1.png" alt="Certificate Template" class="preview-image">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>الصورة الشخصية</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="includePicture" name="includePicture">
                                <label for="includePicture">إضافة صورة شخصية</label>
                            </div>
                            <input type="file" id="pictureInput" accept="image/*" style="display: none;">
                        </div>

                        <button type="submit">إنشاء الشهادة</button>
                    </form>
                </div>

                <div id="certificatePreview" class="hidden">
                    <h2>معاينة الشهادة</h2>
                    <div id="certificateContainer"></div>
                    <button id="downloadCertificate">تحميل الشهادة</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <!-- Footer content -->
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script src="script.js"></script>
    
    <script>
      // Wait for the DOM to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        // Get the button element by its ID
        var downloadBtn = document.getElementById('downloadCertificate');
        
        // Check if the button exists
        if(downloadBtn) {
          // Attach a click event listener
          downloadBtn.addEventListener('click', function() {
            // Log the click event in the console (for testing)
            console.log('Download Certificate button clicked');
    
            // Send the event to Google Analytics
            gtag('event', 'click', {
              'event_category': 'Button',
              'event_label': 'Certs',
              'value': 1
            });
          });
        }
      });
    </script>
    
    <!-- Add a helper message for Facebook users -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Check if user is likely coming from Facebook 
        if (navigator.userAgent.indexOf('FBAN') !== -1 || 
            navigator.userAgent.indexOf('FBAV') !== -1 || 
            navigator.userAgent.indexOf('Instagram') !== -1) {
          // Add a small notice at the top of the page
          var notice = document.createElement('div');
          notice.className = 'facebook-browser-notice';
          notice.innerHTML = '<strong>تنبيه:</strong> أنت تستخدم متصفح فيسبوك الداخلي. للحصول على تجربة أفضل في تنزيل وحفظ الشهادة، <a href="' + window.location.href + '" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline; font-weight: bold;">انقر هنا لفتح الموقع في متصفح خارجي</a>.';
          
          // Insert at the top of the main content
          var main = document.querySelector('main');
          if (main && main.firstChild) {
            main.insertBefore(notice, main.firstChild);
          }
          
          // Also add a reminder near the certificate preview
          var certificatePreview = document.getElementById('certificatePreview');
          if (certificatePreview) {
            certificatePreview.addEventListener('DOMNodeInserted', function() {
              // Check if we already added the reminder
              if (!document.getElementById('fb-preview-reminder')) {
                var reminder = document.createElement('div');
                reminder.id = 'fb-preview-reminder';
                reminder.className = 'facebook-browser-notice';
                reminder.style.marginTop = '15px';
                reminder.innerHTML = 'للحصول على أفضل تجربة، <a href="' + window.location.href + '" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline; font-weight: bold;">انقر هنا</a> أو استخدم زر "فتح في المتصفح الخارجي" أدناه';
                
                // Add after the certificate container
                var container = document.getElementById('certificateContainer');
                if (container && container.parentNode) {
                  container.parentNode.insertBefore(reminder, container.nextSibling);
                }
              }
            }, { once: true });
          }
        }
      });
    </script>
    
    <!-- Handle external parameter -->
    <script>
      // This script handles the special external=true parameter
      // It helps break out of the Facebook browser
      document.addEventListener('DOMContentLoaded', function() {
        // If this is the external=true URL and we're still in Facebook browser
        if (window.isExternalAttempt && isFacebookBrowser()) {
          // We're still in Facebook, add an urgent notice at the top
          var urgentNotice = document.createElement('div');
          urgentNotice.className = 'facebook-browser-urgent-notice';
          urgentNotice.style.backgroundColor = '#f8d7da';
          urgentNotice.style.color = '#721c24';
          urgentNotice.style.padding = '15px';
          urgentNotice.style.marginBottom = '20px';
          urgentNotice.style.borderRadius = '5px';
          urgentNotice.style.textAlign = 'center';
          urgentNotice.style.fontSize = '18px';
          urgentNotice.style.borderRight = '5px solid #f5c6cb';
          
          // Add multiple direct links with different methods
          urgentNotice.innerHTML = '<strong>يرجى اختيار إحدى الخيارات التالية لفتح الموقع في متصفح خارجي:</strong><br><br>' +
                                   '<a href="' + window.location.origin + window.location.pathname + '" target="_blank" style="display:block; margin:10px 0; padding:10px; background-color:#007bff; color:white; text-decoration:none; border-radius:5px;">1. فتح في المتصفح الافتراضي</a>' +
                                   '<a href="https://' + window.location.host + window.location.pathname + '" target="_system" style="display:block; margin:10px 0; padding:10px; background-color:#28a745; color:white; text-decoration:none; border-radius:5px;">2. فتح في متصفح النظام</a>' +
                                   '<a href="intent://' + window.location.host + window.location.pathname + '#Intent;scheme=https;package=com.android.chrome;end" style="display:block; margin:10px 0; padding:10px; background-color:#6c757d; color:white; text-decoration:none; border-radius:5px;">3. فتح في متصفح كروم (أندرويد)</a>';
          
          // Insert at the top of the page
          document.body.insertBefore(urgentNotice, document.body.firstChild);
        }
      });
    </script>
</body>
</html>
